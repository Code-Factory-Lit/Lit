<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>프로젝트 상세</title>

    <link rel="stylesheet" href="/assets/css/project/default.css">
    <link rel="stylesheet" href="/assets/css/project/project.css">
    <link rel="stylesheet" href="/assets/css/default.css">


</head>

<body>

    <header></header>
    <main>
        <div class="mainWrap">
            <section class="sec1" th:object="${projectVO}">
<!--                <div th:object="${projectVO}">-->
                    <div class="projectImg">
                        <a>
                            <!-- 이미지 링크 추가 -->
                            <img src="/lit/display?fileName=" alt="">
                        </a>
                    </div>
                    <div class="projectInfoWrap">
                        <div>
                            <p class="infoKey">
                                챌린지 제목
                            </p>

                            <p>
                                <span>참가인원</span>
                                <span>102</span>
                                <span>게시물</span>
                                <span>201</span>
                            </p>
                        </div>
                        <div>
                            <label for="btn1" class="btn">참여하기</label>
                            <input type="hidden" id="btn1">
                        </div>
                        <div>
                            <p class="infoKey">
                                챌린지 기간
                            </p>
                            <p>
<!--                                <span th:text="*{startDate}~*{endDate}"></span>-->
                            </p>
                        </div>
                        <div>
                            <p class="infoKey">
                                챌린지 소개
                            </p>
<!--                            <p th:text="*{content}">-->
                            </p>
                        </div>
                        <div>
                            <p class="infoKey">
                                인증방법
                            </p>
<!--                            <p th:text="*{authentication}">-->
                            </p>
                        </div>
                    </div>
                </div>
            </section>
            <section class="sec2">
                <div>
<!--                    반복문 -->
<!--                    <figure>-->
<!--                        <a href="">-->
<!--                            <img src="/images/project/domImg/indi01.webp" alt="">-->
<!--                        </a>-->
<!--                    </figure>-->

                </div>
            </section>
        </div>
    </main>
    <aside class="modalWindow">
        <div class="modalWrap">
            <div>윈도우</div>
        </div>
    </aside>
    <footer></footer>
</body>

<script src="/assets/js/jquery-3.6.0.min.js"></script>
<script th:inline="javascript">
    // 페이지 이동시 프로젝트 넘버 가져오기
    // const projectNumber = [[${ projectNumber }]];
    const projectNumber = 1;

    let pageNum = 1; // 인증글 리스트 페이지 번호
    const contBox = $('.sec2 > div');  // 인증글 리스트 출력 위치

    // 첫 이미지 리스트
    litUpList();
    // ajax 서버통신
    function litUpList() {
        console.log("ajax----------------");
        $.ajax({
            url: "/litUp/litInfo/" + pageNum + "/" +projectNumber,
            type: "get",
            dataType: 'json',
            success: function (result) {
                pageNum++; // 다음 페이지 번호 지정
                litupadd(result);
            }, error: function (xhr, textStatus, errorThrown) {
                console.log('통신 실패');
                console.log(xhr);
                console.log(textStatus);
                console.log(errorThrown);
            }
        });
    }
    // LitUp 데이터 Html input
    function litupadd(result) {
        let str = "";
        result.forEach( (data, i) => {
            let file = data.reviewFileList;
            if(file[0]){
                str += "<figure><a href=\"" + data.reviewNumber + "\">";
                str += "<img src=\"/litUp/display?fileName=" + file[0].uploadPath + "/" + file[0].uuid + "_" + file[0].name + "\">";
                str += "</a></figure>";
            }
        })
        contBox.append(str);
    }


    //스크롤 이벤트
    let timer;
    $(window).scroll(function () {
        // 라스트 페이지면 실행 불가
        // if(pageNum == last){
        //     return false;
        // }
        // 현 스크롤 탑의 위치
        let windowTop = $(window).scrollTop();
        // 변화될 아이
        let contentHeight = $(".photoContents").height();
        // 창의 전체 높이
        let windowHeight = $(window).height();

        // 스크롤이 마지막 이면 데이터 가져오기
        if (windowTop > (contentHeight - windowHeight)) {
            // 스크롤 맨 아래
            if (timer) {
                clearTimeout(timer);
            }
            timer = setTimeout(() => {
                litUpList();  // ajax 실행
            }, 500);
        } else {
            //스크롤중..
        }
    });
</script>

</html>
